@page "/guide/power-automate"
@inject IJSRuntime JSRuntime

<PageTitle>Power Automate Setup Guide</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="py-4">
    <MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-2">
        <MudIcon Icon="@Icons.Custom.Brands.Microsoft" Size="Size.Large" />
        <MudText Typo="Typo.h4">Power Automate Setup Guide</MudText>
    </MudStack>
    <MudText Typo="Typo.subtitle1" Class="mud-text-secondary mb-4">
        Export your M365 Calendar Meetings to JSON in 8 simple steps
    </MudText>

    <MudProgressLinear Color="Color.Primary" Value="@GetProgressPercentage()" Class="mb-2" />
    <MudText Typo="Typo.body2" Class="mud-text-secondary mb-4">
        @_completedSteps.Count(s => s) of 8 steps completed
    </MudText>

    <MudTimeline TimelinePosition="TimelinePosition.Start">
        @* Step 1: Create New Power Automate Flow *@
        <MudTimelineItem Color="@GetStepColor(0)" Size="Size.Medium">
            <ItemDot>
                <MudIcon Icon="@Icons.Material.Filled.Add" Size="Size.Small" />
            </ItemDot>
            <ItemContent>
                <MudCard Elevation="1" Class="mb-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                                <div>
                                    <MudText Typo="Typo.h6">Step 1: Create New Power Automate Flow</MudText>
                                    <MudText Typo="Typo.caption" Class="mud-text-secondary">Setup - ~2 minutes</MudText>
                                </div>
                                <MudCheckBox T="bool" @bind-Value="_completedSteps[0]" @bind-Value:after="SaveProgressToStorage"
                                             Color="Color.Success" Label="Complete" />
                            </MudStack>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudList T="string" Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Go to <MudLink Href="https://make.powerautomate.com" Target="_blank">make.powerautomate.com</MudLink>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Click <strong>Create</strong> then <strong>Instant cloud flow</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Enter name: <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined">Export Calendar Meetings to JSON</MudChip>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Select trigger: <strong>Manually trigger a flow</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Click <strong>Create</strong>
                            </MudListItem>
                        </MudList>
                        <MudAlert Severity="Severity.Info" Class="mt-3" Dense="true">
                            <strong>Tip:</strong> Make sure you're signed in with your Microsoft 365 work account before starting.
                        </MudAlert>
                    </MudCardContent>
                </MudCard>
            </ItemContent>
        </MudTimelineItem>

        @* Step 2: Add Input Parameters *@
        <MudTimelineItem Color="@GetStepColor(1)" Size="Size.Medium">
            <ItemDot>
                <MudIcon Icon="@Icons.Material.Filled.Settings" Size="Size.Small" />
            </ItemDot>
            <ItemContent>
                <MudCard Elevation="1" Class="mb-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                                <div>
                                    <MudText Typo="Typo.h6">Step 2: Add Input Parameters</MudText>
                                    <MudText Typo="Typo.caption" Class="mud-text-secondary">Setup - ~1 minute</MudText>
                                </div>
                                <MudCheckBox T="bool" @bind-Value="_completedSteps[1]" @bind-Value:after="SaveProgressToStorage"
                                             Color="Color.Success" Label="Complete" />
                            </MudStack>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudList T="string" Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                In the manual trigger, click <strong>Add an input</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Select <strong>Text</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Input name: <code>Subject Filter</code>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Mark as <strong>Required</strong>
                            </MudListItem>
                        </MudList>
                    </MudCardContent>
                </MudCard>
            </ItemContent>
        </MudTimelineItem>

        @* Step 3: List Calendar Events *@
        <MudTimelineItem Color="@GetStepColor(2)" Size="Size.Medium">
            <ItemDot>
                <MudIcon Icon="@Icons.Material.Filled.CalendarMonth" Size="Size.Small" />
            </ItemDot>
            <ItemContent>
                <MudCard Elevation="1" Class="mb-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                                <div>
                                    <MudText Typo="Typo.h6">Step 3: List Calendar Events</MudText>
                                    <MudText Typo="Typo.caption" Class="mud-text-secondary">Configure - ~2 minutes</MudText>
                                </div>
                                <MudCheckBox T="bool" @bind-Value="_completedSteps[2]" @bind-Value:after="SaveProgressToStorage"
                                             Color="Color.Success" Label="Complete" />
                            </MudStack>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudList T="string" Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Click <strong>+ New step</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Search for <strong>Office 365 Outlook</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Choose: <strong>Get calendar view of events (V3)</strong>
                            </MudListItem>
                        </MudList>

                        <MudText Typo="Typo.subtitle2" Class="mt-3 mb-2">Configure Parameters:</MudText>
                        <MudPaper Class="pa-3" Elevation="0" Style="background: var(--mud-palette-background-gray);">
                            <MudStack Spacing="1">
                                <MudText Typo="Typo.body2"><strong>Calendar id:</strong> <code>Calendar</code></MudText>
                                <MudText Typo="Typo.body2"><strong>Start Time:</strong> <code>addDays(utcNow(), -365)</code></MudText>
                                <MudText Typo="Typo.body2"><strong>End Time:</strong> <code>utcNow()</code></MudText>
                                <MudText Typo="Typo.body2"><strong>Time Zone:</strong> <code>UTC</code></MudText>
                                <MudText Typo="Typo.body2"><strong>Top Count:</strong> <code>1000</code></MudText>
                            </MudStack>
                        </MudPaper>
                    </MudCardContent>
                </MudCard>
            </ItemContent>
        </MudTimelineItem>

        @* Step 4: Filter Events by Subject *@
        <MudTimelineItem Color="@GetStepColor(3)" Size="Size.Medium">
            <ItemDot>
                <MudIcon Icon="@Icons.Material.Filled.FilterAlt" Size="Size.Small" />
            </ItemDot>
            <ItemContent>
                <MudCard Elevation="1" Class="mb-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                                <div>
                                    <MudText Typo="Typo.h6">Step 4: Filter Events by Subject</MudText>
                                    <MudText Typo="Typo.caption" Class="mud-text-secondary">Configure - ~1 minute</MudText>
                                </div>
                                <MudCheckBox T="bool" @bind-Value="_completedSteps[3]" @bind-Value:after="SaveProgressToStorage"
                                             Color="Color.Success" Label="Complete" />
                            </MudStack>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudList T="string" Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Click <strong>+ New step</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Search for and select <strong>Data Operation</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Choose <strong>Filter array</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                <strong>From:</strong> Click in the field and select "value" from the dynamic content
                            </MudListItem>
                        </MudList>

                        <MudText Typo="Typo.subtitle2" Class="mt-3 mb-2">Configure Condition:</MudText>
                        <MudPaper Class="pa-3" Elevation="0" Style="background: var(--mud-palette-background-gray);">
                            <MudText Typo="Typo.body2" Class="mb-2">Click <strong>Edit in advanced mode</strong> and paste:</MudText>
                            <code>@@contains(item()?['subject'], triggerBody()['text'])</code>
                        </MudPaper>
                    </MudCardContent>
                </MudCard>
            </ItemContent>
        </MudTimelineItem>

        @* Step 5: Transform to Required JSON Format *@
        <MudTimelineItem Color="@GetStepColor(4)" Size="Size.Medium">
            <ItemDot>
                <MudIcon Icon="@Icons.Material.Filled.Transform" Size="Size.Small" />
            </ItemDot>
            <ItemContent>
                <MudCard Elevation="1" Class="mb-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                                <div>
                                    <MudText Typo="Typo.h6">Step 5: Transform to Required JSON Format</MudText>
                                    <MudText Typo="Typo.caption" Class="mud-text-secondary">Configure - ~3 minutes</MudText>
                                </div>
                                <MudCheckBox T="bool" @bind-Value="_completedSteps[4]" @bind-Value:after="SaveProgressToStorage"
                                             Color="Color.Success" Label="Complete" />
                            </MudStack>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudList T="string" Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Click <strong>+ New step</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Select <strong>Data Operation</strong> then <strong>Select</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                <strong>From:</strong> Output from Filter array action
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Click <strong>Map</strong> and add these fields:
                            </MudListItem>
                        </MudList>

                        <MudText Typo="Typo.subtitle2" Class="mt-3 mb-2">Field Mappings:</MudText>
                        <MudPaper Class="pa-3" Elevation="0" Style="background: var(--mud-palette-background-gray);">
                            <MudStack Spacing="2">
                                <MudText Typo="Typo.body2"><strong>subject:</strong> <code>item()?['subject']</code></MudText>
                                <div>
                                    <MudText Typo="Typo.body2"><strong>start:</strong> Click "Switch to input entire array" and enter:</MudText>
                                    <pre style="font-size: 0.85rem; margin-top: 4px;">{ "dateTime": "@@{item()?['start']?['dateTime']}", "timeZone": "@@{item()?['start']?['timeZone']}" }</pre>
                                </div>
                                <div>
                                    <MudText Typo="Typo.body2"><strong>end:</strong> Click "Switch to input entire array" and enter:</MudText>
                                    <pre style="font-size: 0.85rem; margin-top: 4px;">{ "dateTime": "@@{item()?['end']?['dateTime']}", "timeZone": "@@{item()?['end']?['timeZone']}" }</pre>
                                </div>
                                <MudText Typo="Typo.body2"><strong>isAllDay:</strong> <code>item()?['isAllDay']</code></MudText>
                            </MudStack>
                        </MudPaper>
                    </MudCardContent>
                </MudCard>
            </ItemContent>
        </MudTimelineItem>

        @* Step 6: Create JSON Wrapper *@
        <MudTimelineItem Color="@GetStepColor(5)" Size="Size.Medium">
            <ItemDot>
                <MudIcon Icon="@Icons.Material.Filled.Code" Size="Size.Small" />
            </ItemDot>
            <ItemContent>
                <MudCard Elevation="1" Class="mb-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                                <div>
                                    <MudText Typo="Typo.h6">Step 6: Create JSON Wrapper</MudText>
                                    <MudText Typo="Typo.caption" Class="mud-text-secondary">Configure - ~1 minute</MudText>
                                </div>
                                <MudCheckBox T="bool" @bind-Value="_completedSteps[5]" @bind-Value:after="SaveProgressToStorage"
                                             Color="Color.Success" Label="Complete" />
                            </MudStack>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudList T="string" Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Click <strong>+ New step</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Select <strong>Data Operation</strong> then <strong>Compose</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                In the <strong>Inputs</strong> field, switch to code view and paste:
                            </MudListItem>
                        </MudList>

                        <MudPaper Class="pa-3 mt-2" Elevation="0" Style="background: var(--mud-palette-background-gray);">
                            <pre style="font-size: 0.85rem; margin: 0;">{
  "events": @@{body('Select')},
  "exportDate": "@@{utcNow()}",
  "subjectFilter": "@@{triggerBody()['text']}"
}</pre>
                        </MudPaper>
                    </MudCardContent>
                </MudCard>
            </ItemContent>
        </MudTimelineItem>

        @* Step 7: Save to OneDrive *@
        <MudTimelineItem Color="@GetStepColor(6)" Size="Size.Medium">
            <ItemDot>
                <MudIcon Icon="@Icons.Material.Filled.CloudUpload" Size="Size.Small" />
            </ItemDot>
            <ItemContent>
                <MudCard Elevation="1" Class="mb-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                                <div>
                                    <MudText Typo="Typo.h6">Step 7: Save to OneDrive</MudText>
                                    <MudText Typo="Typo.caption" Class="mud-text-secondary">Output - ~2 minutes</MudText>
                                </div>
                                <MudCheckBox T="bool" @bind-Value="_completedSteps[6]" @bind-Value:after="SaveProgressToStorage"
                                             Color="Color.Success" Label="Complete" />
                            </MudStack>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudList T="string" Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Click <strong>+ New step</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Search for and select <strong>OneDrive for Business</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Choose <strong>Create file</strong>
                            </MudListItem>
                        </MudList>

                        <MudText Typo="Typo.subtitle2" Class="mt-3 mb-2">Configure File Settings:</MudText>
                        <MudPaper Class="pa-3" Elevation="0" Style="background: var(--mud-palette-background-gray);">
                            <MudStack Spacing="1">
                                <MudText Typo="Typo.body2"><strong>Folder Path:</strong> <code>/Documents/CalendarExports</code></MudText>
                                <MudText Typo="Typo.body2"><strong>File Name:</strong> <code>calendar_export_@@{formatDateTime(utcNow(), 'yyyyMMdd_HHmmss')}.json</code></MudText>
                                <MudText Typo="Typo.body2"><strong>File Content:</strong> Select "Outputs" from the Compose step</MudText>
                            </MudStack>
                        </MudPaper>

                        <MudAlert Severity="Severity.Warning" Class="mt-3" Dense="true">
                            <strong>Note:</strong> Create the folder <code>/Documents/CalendarExports</code> in OneDrive before running the flow.
                        </MudAlert>

                        <MudAlert Severity="Severity.Info" Class="mt-2" Dense="true">
                            <strong>Alternative:</strong> You can use <strong>SharePoint</strong> instead of OneDrive by selecting "SharePoint" - "Create file" and choosing your site.
                        </MudAlert>
                    </MudCardContent>
                </MudCard>
            </ItemContent>
        </MudTimelineItem>

        @* Step 8: Test & Export Your Flow *@
        <MudTimelineItem Color="@GetStepColor(7)" Size="Size.Medium">
            <ItemDot>
                <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Size="Size.Small" />
            </ItemDot>
            <ItemContent>
                <MudCard Elevation="1" Class="mb-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                                <div>
                                    <MudText Typo="Typo.h6">Step 8: Test & Export Your Flow</MudText>
                                    <MudText Typo="Typo.caption" Class="mud-text-secondary">Test - ~2 minutes</MudText>
                                </div>
                                <MudCheckBox T="bool" @bind-Value="_completedSteps[7]" @bind-Value:after="SaveProgressToStorage"
                                             Color="Color.Success" Label="Complete" />
                            </MudStack>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudText Typo="Typo.subtitle2" Class="mb-2">Running Your Flow:</MudText>
                        <MudList T="string" Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Go to <MudLink Href="https://make.powerautomate.com" Target="_blank">make.powerautomate.com</MudLink>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Click on <strong>My flows</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Find your flow and click <strong>Run</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Enter the meeting subject you want to filter (e.g., "Project Standup")
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Click <strong>Run flow</strong>
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Go to OneDrive - Documents - CalendarExports
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Download the latest JSON file
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.ChevronRight">
                                Upload it to the Storingsdienst web application
                            </MudListItem>
                        </MudList>

                        <MudText Typo="Typo.subtitle2" Class="mt-4 mb-2">Expected JSON Output Format:</MudText>
                        <MudPaper Class="pa-3" Elevation="0" Style="background: var(--mud-palette-background-gray);">
                            <pre style="font-size: 0.8rem; margin: 0;">{
  "events": [
    {
      "subject": "Project Standup",
      "start": { "dateTime": "2024-01-15T09:00:00", "timeZone": "UTC" },
      "end": { "dateTime": "2024-01-15T09:30:00", "timeZone": "UTC" },
      "isAllDay": false
    }
  ],
  "exportDate": "2025-01-15T14:30:00Z",
  "subjectFilter": "Project Standup"
}</pre>
                        </MudPaper>

                        <MudAlert Severity="Severity.Success" Class="mt-4" Variant="Variant.Filled">
                            <MudText Typo="Typo.subtitle1"><strong>Congratulations!</strong></MudText>
                            <MudText Typo="Typo.body2">
                                Your Power Automate flow is now complete. You can run it anytime to export your calendar meetings to JSON format.
                            </MudText>
                        </MudAlert>

                        <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Large"
                                   StartIcon="@Icons.Material.Filled.Home" Href="/" Class="mt-4" FullWidth="true">
                            Return to Home & Upload Your JSON
                        </MudButton>
                    </MudCardContent>
                </MudCard>
            </ItemContent>
        </MudTimelineItem>
    </MudTimeline>

    @* Troubleshooting Section *@
    <MudExpansionPanels Class="mt-4">
        <MudExpansionPanel Text="Troubleshooting" Icon="@Icons.Material.Filled.Build">
            <MudGrid>
                <MudItem xs="12" md="6">
                    <MudText Typo="Typo.subtitle2" Color="Color.Error" Class="mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Cancel" Size="Size.Small" />
                        Flow fails with "Unauthorized"
                    </MudText>
                    <MudList T="string" Dense="true">
                        <MudListItem>Ensure you've authorized the Office 365 Outlook and OneDrive connections</MudListItem>
                        <MudListItem>Go to Connections and re-authenticate if needed</MudListItem>
                    </MudList>

                    <MudText Typo="Typo.subtitle2" Color="Color.Error" Class="mt-3 mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Cancel" Size="Size.Small" />
                        No events in the output
                    </MudText>
                    <MudList T="string" Dense="true">
                        <MudListItem>Check that your subject filter matches actual meeting titles (case-sensitive!)</MudListItem>
                        <MudListItem>Verify meetings exist in the past year</MudListItem>
                        <MudListItem>Try a partial match (e.g., "Standup" instead of "Project Standup Meeting")</MudListItem>
                    </MudList>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudText Typo="Typo.subtitle2" Color="Color.Error" Class="mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Cancel" Size="Size.Small" />
                        JSON file not found in OneDrive
                    </MudText>
                    <MudList T="string" Dense="true">
                        <MudListItem>Ensure the <code>/Documents/CalendarExports</code> folder exists</MudListItem>
                        <MudListItem>Check the flow run history for errors</MudListItem>
                        <MudListItem>Verify OneDrive connection is authorized</MudListItem>
                    </MudList>

                    <MudText Typo="Typo.subtitle2" Color="Color.Error" Class="mt-3 mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Cancel" Size="Size.Small" />
                        Invalid JSON error in the app
                    </MudText>
                    <MudList T="string" Dense="true">
                        <MudListItem>Download and open the JSON file in a text editor</MudListItem>
                        <MudListItem>Verify it matches the expected format above</MudListItem>
                        <MudListItem>Check for any error messages in the file</MudListItem>
                    </MudList>
                </MudItem>
            </MudGrid>
        </MudExpansionPanel>

        <MudExpansionPanel Text="Security & Privacy" Icon="@Icons.Material.Filled.Security">
            <MudList T="string" Dense="true">
                <MudListItem Icon="@Icons.Material.Filled.Check" IconColor="Color.Success">
                    The flow runs entirely within your Microsoft 365 tenant
                </MudListItem>
                <MudListItem Icon="@Icons.Material.Filled.Check" IconColor="Color.Success">
                    No data is sent to external services
                </MudListItem>
                <MudListItem Icon="@Icons.Material.Filled.Check" IconColor="Color.Success">
                    JSON files are stored in your personal OneDrive
                </MudListItem>
                <MudListItem Icon="@Icons.Material.Filled.Check" IconColor="Color.Success">
                    You can delete JSON files after importing them to the app
                </MudListItem>
            </MudList>
        </MudExpansionPanel>
    </MudExpansionPanels>
</MudContainer>

@code {
    private bool[] _completedSteps = new bool[8];

    private double GetProgressPercentage() => (_completedSteps.Count(s => s) / 8.0) * 100;

    private Color GetStepColor(int stepIndex) => _completedSteps[stepIndex] ? Color.Success : Color.Primary;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await LoadProgressFromStorage();
        }
    }

    private async Task LoadProgressFromStorage()
    {
        try
        {
            var savedProgress = await JSRuntime.InvokeAsync<string?>("localStorage.getItem", "guideProgressMud");
            if (!string.IsNullOrEmpty(savedProgress))
            {
                var completed = System.Text.Json.JsonSerializer.Deserialize<bool[]>(savedProgress);
                if (completed != null && completed.Length == 8)
                {
                    _completedSteps = completed;
                    StateHasChanged();
                }
            }
        }
        catch { }
    }

    private async Task SaveProgressToStorage()
    {
        try
        {
            var json = System.Text.Json.JsonSerializer.Serialize(_completedSteps);
            await JSRuntime.InvokeVoidAsync("localStorage.setItem", "guideProgressMud", json);
        }
        catch { }
    }
}

<style>
    code {
        background-color: rgba(0, 0, 0, 0.05);
        padding: 2px 6px;
        border-radius: 4px;
        font-family: 'Consolas', 'Courier New', monospace;
    }
    pre {
        background-color: rgba(0, 0, 0, 0.05);
        padding: 8px 12px;
        border-radius: 4px;
        overflow-x: auto;
    }
</style>
