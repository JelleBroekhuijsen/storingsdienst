@page "/authentication/{action}"
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@inject ILocalizationService L
@implements IDisposable

<PageTitle>@L["Authentication"]</PageTitle>

<RemoteAuthenticatorView Action="@Action">
    <LoggingIn>
        <MudContainer MaxWidth="MaxWidth.Small" Class="d-flex align-center justify-center" Style="height: 100vh;">
            <MudStack AlignItems="AlignItems.Center" Spacing="3">
                <MudProgressCircular Color="Color.Primary" Size="Size.Large" Indeterminate="true" />
                <MudText Typo="Typo.h5">@L["SigningInWithMicrosoft"]</MudText>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">@L["PleaseWaitAuthentication"]</MudText>
            </MudStack>
        </MudContainer>
    </LoggingIn>
    <CompletingLoggingIn>
        <MudContainer MaxWidth="MaxWidth.Small" Class="d-flex align-center justify-center" Style="height: 100vh;">
            <MudStack AlignItems="AlignItems.Center" Spacing="3">
                <MudProgressCircular Color="Color.Success" Size="Size.Large" Indeterminate="true" />
                <MudText Typo="Typo.h5">@L["CompletingSignIn"]</MudText>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">@L["AlmostThere"]</MudText>
            </MudStack>
        </MudContainer>
    </CompletingLoggingIn>
    <LogOut>
        <MudContainer MaxWidth="MaxWidth.Small" Class="d-flex align-center justify-center" Style="height: 100vh;">
            <MudStack AlignItems="AlignItems.Center" Spacing="3">
                <MudProgressCircular Color="Color.Warning" Size="Size.Large" Indeterminate="true" />
                <MudText Typo="Typo.h5">@L["SigningOut"]</MudText>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">@L["PleaseWait"]</MudText>
            </MudStack>
        </MudContainer>
    </LogOut>
    <CompletingLogOut>
        <MudContainer MaxWidth="MaxWidth.Small" Class="d-flex align-center justify-center" Style="height: 100vh;">
            <MudStack AlignItems="AlignItems.Center" Spacing="3">
                <MudProgressCircular Color="Color.Info" Size="Size.Large" Indeterminate="true" />
                <MudText Typo="Typo.h5">@L["CompletingSignOut"]</MudText>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">@L["AlmostThere"]</MudText>
            </MudStack>
        </MudContainer>
    </CompletingLogOut>
    <LogInFailed>
        <MudContainer MaxWidth="MaxWidth.Small" Class="mt-5">
            <MudAlert Severity="Severity.Error" Variant="Variant.Filled" Class="mb-4">
                <MudStack Spacing="2">
                    <MudText Typo="Typo.h6">
                        <MudIcon Icon="@Icons.Material.Filled.Warning" Class="mr-2" />
                        @L["AuthenticationFailed"]
                    </MudText>
                    <MudText Typo="Typo.body2">@L["AuthFailedExplanation"]</MudText>
                    <MudList T="string" Dense="true">
                        <MudListItem>@L["InvalidOrExpiredCredentials"]</MudListItem>
                        <MudListItem>@L["MissingPermissions"]</MudListItem>
                        <MudListItem>@L["AzureAdConfigIssues"]</MudListItem>
                    </MudList>
                </MudStack>
            </MudAlert>
            <MudStack Row="true" Spacing="2">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/"
                           StartIcon="@Icons.Material.Filled.Home">
                    @L["ReturnToHome"]
                </MudButton>
                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Href="authentication/login"
                           StartIcon="@Icons.Material.Filled.Refresh">
                    @L["TryAgain"]
                </MudButton>
            </MudStack>
        </MudContainer>
    </LogInFailed>
    <LogOutFailed>
        <MudContainer MaxWidth="MaxWidth.Small" Class="mt-5">
            <MudAlert Severity="Severity.Warning" Variant="Variant.Filled" Class="mb-4">
                <MudStack Spacing="2">
                    <MudText Typo="Typo.h6">
                        <MudIcon Icon="@Icons.Material.Filled.Warning" Class="mr-2" />
                        @L["SignOutFailed"]
                    </MudText>
                    <MudText Typo="Typo.body2">@L["SignOutFailedExplanation"]</MudText>
                </MudStack>
            </MudAlert>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/"
                       StartIcon="@Icons.Material.Filled.Home">
                @L["ReturnToHome"]
            </MudButton>
        </MudContainer>
    </LogOutFailed>
</RemoteAuthenticatorView>

@code {
    [Parameter]
    public string? Action { get; set; }

    protected override void OnInitialized()
    {
        L.OnLanguageChanged += OnLanguageChanged;
    }

    private void OnLanguageChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        L.OnLanguageChanged -= OnLanguageChanged;
    }
}
